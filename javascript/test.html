<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Poblacio comarques catalunya</title>
	<script src="https://d3js.org/d3.v7.min.js"></script>
	<style>
		body {
			font-family: Arial, sans-serif;
		}
		svg {
			width: 100%;
			height: 600px; /* Set map height */
		}
		.region {
			stroke: white;
			stroke-width: 1;
		}
		.region:hover {
			fill: orange;
		}
		#map-container {
			display: flex;
			flex-direction: column;
			align-items: center;
			margin-top: 10px;
		}
		#data-container {
			display: flex;
			flex-direction: row;
			align-items: center;
			height: min(80vw, 80vh);
		}
		#rectangle {
			width: min(80vw, 80vh);
			height: min(80vw, 80vh);
			border: 2px solid black;
			margin: auto;
			display: flex;
			justify-content: center;
			align-items: center;
		}
		#gradient-scale {
			width: 20px;
			height: 100%;
			background: linear-gradient(to top, #ffcccc, #ff9999, #ff6666, #ff3333, #ff0000);
			border: 1px solid black;
			margin-left: 20px;
		}

		h1 {
			text-align: center;
			margin-bottom: 30px;
		}
	</style>
</head>
<body>

<div id="map-container">
	<h1>Poblacio comarques de catalunya</h1>
	<div id="data-container">
		<div id="rectangle">
			<svg id="map"></svg>
		</div>
		<div id="gradient-scale"></div>
	</div>
</div>

<script>
	// Set dimensions and create the SVG element
	const svg = d3.select("#map"),
		width = +svg.attr("width"),
		height = +svg.attr("height");

	// Define a projection
	const projection = d3.geoMercator()
						.center([2.105, 41.572]); // Center coordinates;

	const path = d3.geoPath().projection(projection);

	// Create a g element to hold the map paths
	const g = svg.append("g");

	// Set up the color scale for population
	const colorScale = d3.scaleLinear()
		.domain([0, 10000, 50000]) // Define the domain (min, midpoint, max) adjust as needed
		.range(["#ffcccc", "#ff6666", "#ff0000"]); // Corresponding colors

	// Adjust the map's dimensions and keep it centered on window resize
	function resizeMap() {
		const rectWidth = Math.min(window.innerWidth, window.innerHeight);
		const rectHeight = rectWidth;

		// Update projection to keep it centered
		projection
			.scale(rectWidth * 13)
			.translate([rectWidth / 2, rectHeight / 2]);

		// Update the size of the svg container
		svg.attr("width", rectWidth).attr("height", rectHeight);

		// Recalculate and redraw paths
		g.selectAll("path").attr("d", path);
	}

	resizeMap();
	window.addEventListener('resize', resizeMap);

	// Load GeoJSON data
	d3.json('geojson_files/comarques.geojson').then(data => {
		g.selectAll(".region")
		.data(data.features)
		.enter().append("path")
		.attr("class", "region")
		.attr("d", path)
		.style("fill", d => {
			return colorScale(d.properties.Total || 0);
		})
		.on("mouseover", function(event, d) {
			d3.select(this).style("fill", "orange");
			const tooltip = d3.select("body").append("div")
				.attr("class", "tooltip")
				.html(`Comarca: ${d.properties.NOMCOMAR}<br>Total: ${(d.properties.Total || 0).toLocaleString('de-DE')}`)
				.style("position", "absolute")
				.style("background", "lightgrey")
				.style("padding", "5px")
				.style("border", "1px solid black")
				.style("left", (event.pageX + 5) + "px")
				.style("top", (event.pageY - 28) + "px");
		})
		.on("mouseout", function(event, d) {
			d3.select(this).style("fill", colorScale(d.properties.Total || 0));
			d3.selectAll(".tooltip").remove();
		});
	}).catch(error => {
		console.error('Error loading GeoJSON:', error);
	});

</script>

</body>
</html>
