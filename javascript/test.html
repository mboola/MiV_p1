<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>GeoJSON Map with D3</title>
	<script src="https://d3js.org/d3.v7.min.js"></script>
	<style>
		body {
			font-family: Arial, sans-serif;
		}
		svg {
			width: 100%;
			height: 600px; /* Set map height */
		}
		.region {
			fill: steelblue; /* Default fill color */
			stroke: white;
			stroke-width: 1;
		}
		.region:hover {
			fill: orange; /* Change fill color on hover */
		}
	</style>
</head>
<body>

<div id="rectangle" style="width: min(80vw, 80vh); height: min(80vw, 80vh); border: 2px solid black; margin: auto; display: flex; justify-content: center; align-items: center;">
	<svg id="map"></svg>
</div>	

<script>
	// Set dimensions and create the SVG element
	const svg = d3.select("#map"),
		width = +svg.attr("width"),
		height = +svg.attr("height");

	// Define a projection
	const projection = d3.geoMercator()
						.center([1.485, 41.472]); // Center coordinates;

	const path = d3.geoPath().projection(projection);

	// Create a g element to hold the map paths
	const g = svg.append("g");

	// Adjust the map's dimensions and keep it centered on window resize
	function resizeMap() {
		const rectWidth = Math.min(window.innerWidth, window.innerHeight) * 0.8;
		const rectHeight = rectWidth;

		// Update projection to keep it centered
		projection
			.translate([rectWidth / 2, rectHeight])
			.scale(rectWidth * 15); // Adjust scale based on rectangle size

		// Update the size of the svg container
		svg.attr("width", rectWidth).attr("height", rectHeight);

		// Recalculate and redraw paths
		g.selectAll("path").attr("d", path);
	}

	// Initial map setup
	resizeMap();

	// Update on window resize
	window.addEventListener('resize', resizeMap);

	// Load GeoJSON data
	d3.json('geojson_files/comarques.geojson').then(data => {
		g.selectAll(".region")
		.data(data.features)
		.enter().append("path")
		.attr("class", "region")
		.attr("d", path)
		.on("mouseover", function(event, d) {
			d3.select(this).style("fill", "orange"); // Highlight on hover
			const tooltip = d3.select("body").append("div")
				.attr("class", "tooltip")
				.style("position", "absolute")
				.style("background", "lightgrey")
				.style("padding", "5px")
				.style("border", "1px solid black")
				.html(`Comarca: ${d.properties.NOMCOMAR}`)
				.style("left", (event.pageX + 5) + "px")
				.style("top", (event.pageY - 28) + "px");
		})
		.on("mouseout", function() {
			d3.select(this).style("fill", "steelblue"); // Reset color
			d3.selectAll(".tooltip").remove(); // Remove tooltip
		});
	}).catch(error => {
		console.error('Error loading GeoJSON:', error);
	});

</script>

</body>
</html>
